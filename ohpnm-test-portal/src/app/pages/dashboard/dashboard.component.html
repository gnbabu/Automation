<div class="dashboard-container">
  <div class="header-section d-flex justify-content-between align-items-start">
    <div>
      <h1>Test Case Execution Summary</h1>
    </div>
  </div>
  <div class="brand-header-underline"></div>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <p class="mt-1 mb-0 fw-semibold">
        Release Name:
        <span class="text-primary">#{{ selectedLibrary?.libraryName }}</span>
      </p>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-outline-primary">
        <i class="bi bi-file-earmark-spreadsheet"></i> Export CSV
      </button>
      <button class="btn btn-primary">
        <i class="bi bi-file-earmark-pdf"></i> Export PDF
      </button>
    </div>
  </div>

  <div class="filter-card p-3 mb-3">
    <div class="d-flex justify-content-between align-items-end flex-wrap">
      <div>
        <label for="librarySelect" class="form-label">Release Name</label>
        <app-dropdown
          id="librarySelect"
          [options]="libraries"
          valueAccessor="libraryName"
          textAccessor="libraryName"
          placeholder="All Suites"
          [(selected)]="selectedLibrary"
          (selectionChange)="onLibraryChange($event)"
        ></app-dropdown>
      </div>

      <!-- Stats aligned to right -->
      <div class="d-flex gap-3 ms-auto">
        <div class="stats-box">
          <div class="stats-number">{{ totalCases }}</div>
          <div class="stats-label">Total Cases</div>
        </div>

        <div class="stats-box">
          <div class="stats-number text-primary">{{ unassignedCount }}</div>
          <div class="stats-label">Unassigned</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 4 CARD SUMMARY -->
  <div class="row g-3 mb-4">
    <!-- TOTAL TESTS -->
    <div class="col-md-3">
      <div class="summary-card bg-white shadow-sm border-total">
        <p class="text-muted small mb-1">TOTAL TESTS</p>
        <h3 class="fw-bold">{{ totalCases }}</h3>
      </div>
    </div>

    <!-- PASSED -->
    <div class="col-md-3">
      <div class="summary-card bg-white shadow-sm border-passed">
        <p class="text-muted small mb-1">PASSED</p>
        <h3 class="fw-bold text-success">{{ passedCount }}</h3>
        <p class="text-muted small">
          {{ (passedCount / totalCases) * 100 | number : "1.0-1" }}% Success
          Rate
        </p>
      </div>
    </div>

    <!-- FAILED -->
    <div class="col-md-3">
      <div class="summary-card bg-white shadow-sm border-failed">
        <p class="text-muted small mb-1">FAILED</p>
        <h3 class="fw-bold text-danger">{{ failedCount }}</h3>
        <p class="text-muted small">
          {{ (failedCount / totalCases) * 100 | number : "1.0-1" }}% Failure
          Rate
        </p>
      </div>
    </div>

    <!-- RUNNING / SKIPPED -->
    <div class="col-md-3">
      <div class="summary-card bg-white shadow-sm border-running">
        <p class="text-muted small mb-1">RUNNING / SKIPPED</p>
        <h3 class="fw-bold text-warning">
          {{ runningCount + skippedCount }}
        </h3>
        <p class="text-muted small">
          {{
            ((runningCount + skippedCount) / totalCases) * 100
              | number : "1.0-1"
          }}%
        </p>
      </div>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <!-- RUN DETAILS -->
    <div class="col-md-6 d-flex">
      <div class="run-details-card card-equal p-3 flex-fill">
        <h6 class="fw-bold mb-3">Run Details & Timeline</h6>

        <div class="rd-row">
          <span class="rd-label">Start Time:</span>
          <span>09:00 AM, 2025-10-04</span>
        </div>

        <div class="rd-row">
          <span class="rd-label">End Time:</span>
          <span>09:04 AM, 2025-10-04</span>
        </div>

        <div class="rd-row">
          <span class="rd-label">Execution Duration:</span>
          <span>4m 12s</span>
        </div>

        <div class="rd-row">
          <span class="rd-label">Data Cleanup Status:</span>
          <span class="badge bg-success px-3 py-2">Cleanup Successful</span>
        </div>
      </div>
    </div>

    <!-- LOG SUMMARY -->
    <div class="col-md-6 d-flex">
      <div class="log-summary-card card-equal p-3 flex-fill d-flex flex-column">
        <h6 class="fw-bold mb-3">High-Level Log Summary</h6>

        <div class="log-summary-box flex-grow-1 mb-2">
          <p class="text-secondary">[09:00:01] Initializing browser…</p>
          <p class="text-secondary">[09:00:10] Starting Test Case: TC-101</p>
          <p class="text-success">[09:00:25] TC-101 Passed</p>
          <p class="text-success">[09:01:10] TC-205 Passed</p>
          <p class="text-danger">[09:02:18] TC-302 Failed</p>
          <p class="text-warning">[09:03:45] Skipping optional tests…</p>
        </div>

        <a href="#" class="small text-primary">View Full Execution Log</a>
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-card">
    <h5>Individual Test Case Results ( {{ totalCases }} Total)</h5>

    <div class="table-responsive">
      <div class="table-responsive">
        <app-data-grid
          [selectionEnabled]="false"
          [columns]="columns"
          [data]="testCases"
          [pagingEnabled]="true"
          [pageSize]="10"
          [sortingMode]="'client'"
        ></app-data-grid>
      </div>
    </div>
  </div>
</div>

<!-- Test Case ID Bold Template -->
<ng-template #testCaseIdTemplate let-row let-value="value">
  <span class="fw-bold">{{ value }}</span>
</ng-template>

<!-- Priority Template -->
<ng-template #priorityTemplate let-row let-value="value">
  <span
    [ngClass]="{
      'priority-high': value === 'High',
      'priority-medium': value === 'Medium',
      'priority-low': value === 'Low'
    }"
  >
    {{ value }}
  </span>
</ng-template>

<ng-template #statusTemplate let-row let-value="value">
  <span
    class="text-uppercase px-2 py-1 rounded-pill testcase-status"
    [ngClass]="getBadgeClass(value)"
  >
    {{ value }}
  </span>
</ng-template>

<!-- Action Buttons Template -->
<ng-template #actionsTemplate let-row>
  <div class="d-flex gap-2">
    <!-- View Screenshots -->
    <button
      class="icon-camera"
      (click)="onViewScreenshots(row)"
      *ngIf="row.hasScreenshots"
      title="View Screenshots"
    >
      <i class="bi bi-camera"></i>
    </button>
  </div>
</ng-template>

<app-test-screenshot-gallery #galleryComponent [screenshots]="screenshots">
</app-test-screenshot-gallery>
