<div class="test-case-execution-panelcontainer">
  <!-- Header Section -->
  <div
    class="header-section d-flex justify-content-between align-items-start mb-3"
  >
    <div>
      <h1 class="mb-1">Test Case Execution Panel</h1>
      <p class="text-muted mb-0">
        Schedule and execute the test cases assigned to you.
      </p>
    </div>
  </div>

  <div class="brand-header-underline mb-3"></div>

  <!-- Assignment Dropdown -->
  <div class="filter-card p-3 mb-3">
    <div class="d-flex flex-wrap gap-4 align-items-end">
      <div class="d-flex flex-column">
        <label for="assignmentSelect" class="form-label">Assignment</label>
        <app-dropdown
          id="assignmentSelect"
          [options]="assignments"
          valueAccessor="assignmentId"
          textAccessor="assignmentName"
          placeholder="Select Assignment..."
          [(selected)]="selectedAssignment"
          (selectionChange)="onAssignmentChange($event)"
        ></app-dropdown>
      </div>
    </div>
  </div>

  <!-- Selected Assignment Name -->
  <div class="filter-card p-3 mb-3">
    <div
      class="d-flex justify-content-between align-items-center w-100 py-1 px-2"
    >
      <span class="fw-semibold">Selected Assignment Name:</span>
      <span class="text-primary">{{ selectedAssignment?.assignmentName }}</span>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="stat-box">
        <div class="stat-title">Total Assigned</div>
        <div class="stat-value">{{ stats.totalAssigned }}</div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="stat-box">
        <div class="stat-title">Pending Execution</div>
        <div class="stat-value text-warning">{{ stats.pendingExecution }}</div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="stat-box">
        <div class="stat-title">Completed</div>
        <div class="stat-value text-success">{{ stats.completed }}</div>
      </div>
    </div>
  </div>

  <!-- Bulk Schedule Execution -->
  <div class="filter-card p-3 mb-3">
    <div class="row align-items-center g-3">
      <!-- Column 1: Title -->
      <div class="col-md-6">
        <h5 class="fw-semibold m-0">
          Bulk Schedule Execution ({{ selectedTestCases.length }} selected)
        </h5>
      </div>

      <!-- Column 2: Empty or future elements -->
      <div class="col-md-3"></div>

      <!-- Column 3: Buttons side-by-side -->
      <div class="col-md-3 d-flex justify-content-end gap-2">
        <button class="btn-purple" (click)="onBulkRunNow()">
          Bulk Run Now
        </button>
        <button class="btn btn-primary" (click)="onBulkSchedule()">
          Bulk Schedule
        </button>
      </div>
    </div>
  </div>

  <div class="table-card">
    <h5>My Assigned Test Cases</h5>
    <div class="table-responsive">
      <app-data-grid
        [selectionEnabled]="true"
        [columns]="columns"
        [data]="testCases"
        [(selectedRows)]="selectedTestCases"
        [pagingEnabled]="true"
        [pageSize]="10"
        [sortingMode]="'client'"
        (selectedRowsChange)="onSelectionChanged($event)"
      ></app-data-grid>
    </div>
  </div>
</div>

<!-- Test Case ID Bold Template -->
<ng-template #testCaseIdTemplate let-row let-value="value">
  <span class="fw-bold">{{ value }}</span>
</ng-template>

<!-- Priority Template -->
<ng-template #priorityTemplate let-row let-value="value">
  <span
    [ngClass]="{
      'priority-high': value === 'High',
      'priority-medium': value === 'Medium',
      'priority-low': value === 'Low'
    }"
  >
    {{ value }}
  </span>
</ng-template>

<ng-template #statusTemplate let-row let-value="value">
  <span
    class="text-uppercase px-2 py-1 rounded-pill testcase-status"
    [ngClass]="getBadgeClass(value)"
  >
    {{ value }}
  </span>
</ng-template>

<!-- Action Buttons Template -->
<ng-template #actionsTemplate let-row>
  <div class="d-flex gap-2">
    <!-- Run Now -->
    <button class="btn-purple" (click)="onRunNow(row)">Run Now</button>

    <!-- Schedule Execution -->
    <button class="btn btn-primary" (click)="onSchedule(row)">Schedule</button>
  </div>
</ng-template>
<app-schedule-testcases-dialog #scheduleDialog> </app-schedule-testcases-dialog>
