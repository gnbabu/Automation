<div class="app-grid">
  <!-- Pagination Header -->
  <div
    class="d-flex justify-content-between align-items-center mb-2 pagination-header"
    *ngIf="pagingEnabled"
  >
    <div>
      Page Size:
      <select
        [(ngModel)]="pageSize"
        (change)="changePageSize(pageSize)"
        class="form-select d-inline-block w-auto custom-page-size"
      >
        <option *ngFor="let size of [5, 10, 20, 50]" [value]="size">
          {{ size }}
        </option>
      </select>
    </div>
    <div>
      Showing page {{ currentPage }} of {{ totalPages() }} (Total Records:
      {{ pagingMode === "server" ? totalRecords : data.length }})
    </div>
  </div>

  <!-- Data Table -->
  <table class="table table-bordered table-striped grid-table">
    <thead class="table-light">
      <tr>
        <!-- Select All Checkbox -->
        <th *ngIf="selectionEnabled" style="width: 40px; text-align: center">
          <input
            type="checkbox"
            [checked]="allSelected()"
            (change)="toggleSelectAll($event)"
          />
        </th>

        <!-- Column Headers -->
        <th
          *ngFor="let col of columns"
          (click)="col.sortable ? changeSort(col.field) : null"
          [style.cursor]="col.sortable ? 'pointer' : 'default'"
        >
          {{ col.header }}
          <span *ngIf="col.sortable">
            <span *ngIf="sortField === col.field">{{
              sortDirection === "asc" ? "▲" : "▼"
            }}</span>
          </span>
        </th>
      </tr>
    </thead>

    <tbody>
      <!-- No Records -->
      <tr *ngIf="pagedData.length === 0">
        <td
          [attr.colspan]="columns.length + (selectionEnabled ? 1 : 0)"
          class="text-center text-muted"
        >
          {{ noDataMessage || "No records found" }}
        </td>
      </tr>

      <!-- Table Rows -->
      <tr *ngFor="let row of pagedData">
        <!-- Row Selection Checkbox -->
        <td *ngIf="selectionEnabled" class="text-center">
          <input
            type="checkbox"
            [(ngModel)]="row.selected"
            (change)="onRowSelect(row)"
          />
        </td>

        <!-- Row Cells -->
        <td *ngFor="let col of columns">
          <ng-container *ngIf="col.cellTemplate; else defaultCell">
            <ng-container
              *ngTemplateOutlet="
                col.cellTemplate;
                context: { $implicit: row, value: row[col.field] }
              "
            ></ng-container>
          </ng-container>

          <ng-template #defaultCell>
            <ng-container [ngSwitch]="col.type">
              <!-- Date -->
              <span
                class="cell-text"
                *ngSwitchCase="'date'"
                [title]="row[col.field] | date : 'MM-dd-yyyy'"
              >
                {{ row[col.field] | date : "MM-dd-yyyy" }}
              </span>

              <!-- DateTime -->
              <span
                class="cell-text"
                *ngSwitchCase="'datetime'"
                [title]="row[col.field] | date : 'MM-dd-yyyy HH:mm:ss'"
              >
                {{ row[col.field] | date : "MM-dd-yyyy HH:mm:ss" }}
              </span>

              <!-- Default -->
              <span *ngSwitchDefault [title]="row[col.field]" class="cell-text">
                {{ row[col.field] }}
              </span>
            </ng-container>
          </ng-template>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="d-flex justify-content-end mt-3">
    <nav *ngIf="pagingEnabled && totalPages() > 1">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="changePage(currentPage - 1)"
            >Previous</a
          >
        </li>
        <li
          class="page-item"
          *ngFor="let p of [].constructor(totalPages()); let i = index"
          [class.active]="i + 1 === currentPage"
        >
          <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages()">
          <a class="page-link" (click)="changePage(currentPage + 1)">Next</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
